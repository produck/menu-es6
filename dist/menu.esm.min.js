/*!
 * @produck/menu v0.1.3
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
const t=Object.assign,e=t=>{throw new Error(t)},s=(t,e)=>t instanceof e,n=(t,e)=>typeof t===e,i=t=>Array.isArray(t),o=t=>n(t,"function"),r=t=>n(t,"string"),c=t=>n(t,"boolean"),l=t=>null===t,a=document,h=window,u=a.body,m=DocumentFragment,d=(t,e,s)=>{t.addEventListener(e,s)},f=t=>Array.from(t.childNodes).map((e=>$(t,e))),p=t=>a.createElement(t),b=t=>a.createTextNode(t),g=(t,...e)=>{for(const s of e)for(const e in s)t.style.setProperty(e,s[e])},x=(t,e)=>{t.appendChild(e)},$=(t,e)=>{t.removeChild(e)},y=(t,...e)=>{t.classList.add(...e)},w=(t,...e)=>{t.classList.remove(...e)},A=t=>t.stopPropagation(),k=t=>{(t=>{t.preventDefault()})(t),A(t)},_=t=>t.getBoundingClientRect(),C=()=>a.createDocumentFragment(),v=(E="menu",t=>`var(--${E}-${t})`);var E;const S=/^[a-z0-9`~?]$/i,M=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,F=(t,e=!1)=>{const s=C(),n={n:s,f:null},[,i,o,r]=t.match(M);if(void 0===o)x(s,b(i));else if("&&"===o)x(s,b([i,"&",r].join("")));else{const t=o[1];if(e)x(s,b([i,t,r].join("")));else{const e=p("u");e.textContent=t,n.f=t.toLowerCase(),x(s,b(i)),x(s,e),x(s,b(r))}}return n};let N=0,T=0;d(h,"mousedown",(t=>{N=t.clientX,T=t.clientY}));const z={display:"block",border:"1px solid transparent"},U={position:"relative",display:"flex"};class L{}class D{constructor(t){s(t,L)||(t=>{throw new Error(t)})("A menu required.");const e=p("li"),n=p("a");x(e,n),g(e,z),g(n,U),y(e,"menu-item"),this.e=e,this.t=n,this.$=t}L(t){d(this.e,"mouseenter",t)}A(){}get 0(){return!1}}const O=t=>{const e={id:null},{id:s=e.id,type:n}=t;return e.id=s,e.type=n,e},j={"margin-right":"0.5em"},B={"flex-grow":"1",padding:`0 ${v("size-lg")}`};class I extends D{constructor(t,e){super(t);const s=this.t,n=p("span");if(!l(e.icon)){const t=p("span");y(t,"menu-item-icon"),g(t,j),x(n,t),x(t,e.icon)}y(n,"menu-item-label"),g(n,B),x(s,n);const i=F(e.label,!t.h);x(n,i.n),this.l=n,this.L((()=>t.F(this))),this.g=i.f}F(){y(this.e,"focus")}r(){const t=this.e;w(t,"focus")}get 0(){return!0}get _(){return!1}}const X=n=>{const i=t({label:"<NO_LABEL>",icon:null},O(n)),{label:o=i.label,icon:c=i.icon}=n;return r(o)||e("A menu item label MUST be a string."),l(c)||s(c,m)||e("A menu item icon MUST be a DocumentFragment."),i.label=o,i.icon=c,i},R={position:"absolute",height:"100%",width:v("size-lg"),"text-align":"center"},q=p("div"),H={top:0,left:0,width:0,height:"100%",display:"block",position:"fixed","font-size":v("size-md")};g(q,H),y(q,"menu-scope"),x(u,q);let P=null;const W=t=>{x(q,t.m),t.O()},Y=()=>{l(P)||(P.X(),P=null,Z=V=null,g(q,{width:0}))},G=()=>{J().N()},J=()=>{let t=P;for(;!l(t.e);)t=t.e.o;return t},K=()=>{const t=J();return!l(t.o)&&(t.o.C(),!0)},Q={ArrowUp:()=>{J().N(null,!0)},ArrowDown:G,ArrowLeft:K,ArrowRight:()=>{const t=J(),e=t.f;e&&e.sm&&(t.E(),G())},Escape:()=>K()||Y(),Enter:()=>{const t=J().f;t&&t.A()}};d(h,"mousedown",Y),d(h,"blur",Y);let V=null,Z=null;const tt=Object.freeze({get expanding(){return V},get expandable(){return Z},get closed(){return l(P)},next(){P&&P.N()}});d(h,"keydown",(t=>{const{key:e}=t;if(P){const s=J();V=!l(P.e),Z=s.f._,e in Q?Q[e](t):S.test(e)&&s.N(e.toLowerCase())&&s.f.A()}}));const et={top:0,left:0},st={opacity:.4,cursor:"default"};class nt extends I{constructor(t,e){super(t,e);const s=this.e,n=this.t,i=p("span"),o=p("span");y(i,"menu-item-accelerator"),y(o,"menu-item-checkbox"),g(i,B,{"text-align":"right"}),g(o,R,et),x(n,i),x(n,o),x(i,(t=>{const e=t.length-1,s=C();return t.forEach(((t,n)=>{x(s,t),n!==e&&x(s,b(" "))})),s})(e.accelerator)),d(s,"mouseup",(()=>this.C())),d(s,"contextmenu",k),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&(g(this.e,st),y(s,"disabled")),e.isChecked&&y(s,"checked")}get 0(){return!this.d}F(){this.d||super.F()}r(){this.d||super.r()}C(){this.c(),Y()}A(){this.C()}}const it=()=>console.warn(void 0),ot=[],rt=t=>(i(t)||e("Menu options MUST be an array."),t.map((t=>{i(t)||e("Menu item group options MUST be an array.");const s=t=>(t=>{t.type="type"in t?t.type:nt;const s=ot.find((e=>e.t===t.type));return void 0===s&&e("Invalid menu item type."),s.n(t)})(t);return t.reduce(((t,e)=>{const n=o(e)?e().map(s):[s(e)];return t.push(...n),t}),[])}))),ct=(t,e)=>{ot.push({t:t,n:e})},lt={display:"block","border-bottom":`1px solid ${v("mute-front-color")}`,margin:`${v("size-sm")} ${v("size-md")}`};class at extends D{constructor(t){super(t),g(this.t,lt),this.L((()=>t.F()))}}const ht={display:"block",position:"fixed",margin:0,padding:`${v("size-sm")} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":v("size-lg"),background:v("back-color"),color:v("front-color"),"user-select":"none",opacity:0,transition:`opacity ${v("animation-duration")}`},ut=t=>t[0];class mt extends L{constructor(){super();const t=p("ul");g(t,ht),y(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;d(t,"mouseleave",(()=>this.F())),d(t,"mousedown",A),d(t,"mouseenter",(()=>{let t=this.o;for(;!l(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get e(){return this.l.filter((t=>s(t,pt))).find((t=>!l(t.o)))||null}F(t=null){this.f&&this.f.r(),!l(t)&&t.F(),this[this.e===t?"xC":"C"](),this.f=t}E(){s(this.f,pt)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&s(e,pt)&&(this.d=setTimeout((()=>e.C()),t))}xC(){clearTimeout(this.d)}O(){requestAnimationFrame((()=>g(this.m,{opacity:1})))}X(){$(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}N(t=null,e=!1){const s=this.l.filter(ut);e&&s.reverse();const n=s.findIndex((t=>t===this.f)),i=s.length;for(let e=0;e<i;e++){const o=s[(n+e+1)%i];if(l(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const s=rt(t),n=new this,i=C();return n.h=e,s.forEach(((e,s)=>{if(e.forEach((t=>{const e=new t.type(n,t);n.A(e),x(i,e.e)})),s!==t.length-1){const t=new at(n);n.A(t),x(i,t.e)}})),x(n.m,i),n}}const dt={right:0,top:0},ft=(t,e,s=0,n=0)=>{const i=e.bottom,o=e.top-n,r=e.right+s,c=e.left;g(t,{top:`${o}px`,left:`${r}px`});const l=_(t);l.bottom>h.innerHeight&&g(t,{top:i-t.offsetHeight+"px"}),l.right>h.innerWidth&&g(t,{left:c-t.offsetWidth+"px"})};class pt extends I{constructor(t,e){super(t,e);const s=p("span");g(s,R,dt),y(s,"menu-item-expanding"),x(this.t,s),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(l(this.o)){const t=mt.S(this.sm,this.$.h),e=_(this.e);t.o=this,this.o=t,W(t),ft(t.m,e,1,7)}}C(){const t=this.o;l(t)||(t.X(),this.o=null)}A(){this.E(),this.o.N()}_(){return!0}}var bt=Object.freeze({__proto__:null,Clickable:nt,Spearator:at,Submenu:pt});ct(nt,(n=>{const r=t({click:it,isChecked:!1,isDisabled:!1,accelerator:[]},X(n)),{click:l=r.click,isChecked:a=r.isChecked,isDisabled:h=r.isDisabled,accelerator:u=r.accelerator}=n;return o(l)||e("A `.click()` of clickable item MUST be a function."),c(a)||e("A `.isChecked` MUST be a `boolean`."),c(h)||e("A `.isDisabled` MUST be a `boolean`."),i(u)||e("A `.accelerator` MUST be an array of string."),r.accelerator=u.map((t=>(s(t,m)||e("A `.accelerator` MUST be a `DocumentFragement`."),t))),r.click=l,r.isChecked=a,r.isDisabled=h,r})),ct(pt,(e=>{const s=t({submenu:[]},X(e)),{submenu:n=s.submenu}=e;return s.submenu=rt(n),s})),ct(at,(t=>O(t)));const gt=(t={})=>{const s={position:{x:N,y:T},mnemonic:!1,blocking:!1},{position:i=s.position,mnemonic:o=s.mnemonic,blocking:r=s.blocking}=t;if(c(o)||e("A `modifier.mnemonic` MUST be a boolean."),c(r)||e("A `modifier.blocking` MUST be a boolean."),n(i,"object")){const{x:t=s.position.x,y:n=s.position.y}=i;(isNaN(t)||isNaN(n))&&e("Invalid position."),s.position.x=t,s.position.y=n}else e("A `modifier.position` MUST be a boolean.");return s.mnemonic=o,s.blocking=r,s},xt=(t,e)=>{const{position:s,mnemonic:n,blocking:i}=gt(e),o=mt.S(t,n);((t,e=!1)=>{Y(),P=t,e&&g(q,{width:"100%"})})(o,i),W(o),ft(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(s))},$t={_:null,$:null,x:!1},yt=()=>!l($t._)&&!l($t.$);let wt=!1;d(h,"keyup",(t=>{"Alt"===t.key&&(wt=!1)}));const At={Alt:()=>{if(!wt){wt=!0;const t=$t.$.b;t.length>0&&(l($t.$.f)?(Y(),$t.x=$t.$.h=!0,$t.$.f=t[0]):kt())}},Enter:()=>{$t.$.a||($t.$.a=!0,tt.next())},ArrowDown:()=>{$t.$.a||($t.$.a=!0,tt.next())},ArrowLeft:()=>{$t.x&&(tt.closed||!1===tt.expanding)&&($t.$.N(null,!0),$t.$.a&&tt.next())},ArrowRight:()=>{$t.x&&(tt.closed||!1===tt.expandable)&&($t.$.N(),$t.$.a&&tt.next())},Escape:()=>{tt.closed&&($t.$.a?$t.$.a=!1:$t.$.f&&kt())}},kt=()=>{yt()&&($t.$.f=null,wt=$t.$.a=$t.$.h=$t.x=!1)};d(h,"mousedown",kt),d(h,"mouseup",kt),d(h,"blur",kt),d(h,"keydown",(t=>{if(yt()){const e=t.key;e in At?At[e]():S.test(e)&&tt.closed&&($t.$.a||($t.$.a=!0),$t.$.N(e.toLowerCase())&&tt.next())}}));const _t=()=>{$t.$&&$t._&&(f($t._),x($t._,$t.$.e))},Ct={display:"flex",flex:1,"user-select":"none",height:`${v("bar-height")}`,"line-height":`${v("bar-height")}`,"font-size":v("size-md"),color:v("front-color")};class vt{constructor(){const t=p("div");y(t,"menu-bar"),g(t,Ct),this.e=t,this.b=[],d(t,"click",(()=>this.a=!this.a)),d(t,"mousedown",A),d(t,"mouseup",A),d(t,"contextmenu",k),d(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get h(){return this._h}set h(t){this._h=t,this.b.forEach((t=>t.S())),(t?y:w)(this.e,"has-mnemonic")}get a(){return this._a}set a(t){if(t!==this._a){const e=this.e;t?(y(e,"active"),$t.x=!0,this._f&&this._f.O()):(w(e,"active"),Y()),this._a=t}}get f(){return this._f}set f(t){const e=this.f;t!==e&&(l(e)||e.B(),l(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}N(t=null,e=!1){const s=this.b.slice(0);e&&s.reverse();const n=s.findIndex((t=>t===this.f)),i=s.length;for(let e=0;e<i;e++){const o=s[(n+e+1)%i];if(l(t)||o.m===t)return this.f=o,!0}return!1}}const Et={padding:`0 ${v("size-sm")}`};class St{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const s=this.o=p("div"),n=this.i=p("div");y(s,"menu-bar-button"),y(n,"menu-bar-button-title"),x(s,n),g(s,Et);d(s,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=F(this.t,!this.$.h);f(this.i),x(this.i,t.n),this.m=t.f}F(){y(this.o,"focus")}B(){w(this.o,"focus")}O(){const{left:t,bottom:e}=_(this.o),s=rt(this._());xt(s,{position:{x:t,y:e},mnemonic:this.$.h})}}var Mt=Object.freeze({__proto__:null,mount:t=>{$t._=t,_t()},setMenuBar:t=>{const s=(i(n=t)||e("A menu bar options MUST be an array."),n.map((t=>{const s={title:"defalut",menu:[]},{title:n=s.title,menu:i=s.menu}=t;return r(n)||e("A menu bar button title MUST be a string."),s.menu=o(i)?i:()=>i,s.title=n,s})));var n;const c=$t.$=new vt,l=C();s.forEach((t=>{const e=new St(c,t);c.A(e),x(l,e.o)})),x(c.e,l),_t()}});export{Mt as Bar,bt as MenuItem,Y as closeAllMenu,xt as popup};
