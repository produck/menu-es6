/*!
 * @produck/menu v0.1.5
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
const t=Object.assign,e=t=>{throw new Error(t)},n=(t,e)=>t instanceof e,s=(t,e)=>typeof t===e,i=t=>Array.isArray(t),o=t=>s(t,"function"),r=t=>s(t,"string"),c=t=>s(t,"boolean"),l=t=>null===t,a=t=>t.toLowerCase(),h=document,u=window,m=h.body,d=DocumentFragment,f=(t,e,n)=>{t.addEventListener(e,n)},p=t=>Array.from(t.childNodes).map((e=>y(t,e))),b=t=>h.createElement(t),g=t=>h.createTextNode(t),x=(t,...e)=>{for(const n of e)for(const e in n)t.style.setProperty(e,n[e])},$=(t,e)=>{t.appendChild(e)},y=(t,e)=>{t.removeChild(e)},A=(t,...e)=>{t.classList.add(...e)},k=(t,...e)=>{t.classList.remove(...e)},w=t=>t.stopPropagation(),_=t=>{(t=>{t.preventDefault()})(t),w(t)},C=t=>t.getBoundingClientRect(),v=()=>h.createDocumentFragment(),E={display:"block",border:"1px solid transparent"},S={position:"relative",display:"flex"};class M{}class T{constructor(t){n(t,M)||e("A menu required.");const s=b("li"),i=b("a");$(s,i),x(s,E),x(i,S),A(s,"menu-item"),this.e=s,this.t=i,this.$=t}L(t){f(this.e,"mouseenter",t)}A(){}get 0(){return!1}}const F=t=>{const e={id:null},{id:n=e.id,type:s}=t;return e.id=n,e.type=s,e},N=(z="menu",t=>`var(--${z}-${t})`);var z;const U=/^[a-z0-9`~?]$/i,D=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,L=(t,e=!1)=>{const n=v(),s={n:n,f:null},[,i,o,r]=t.match(D);if(void 0===o)$(n,g(i));else if("&&"===o)$(n,g([i,"&",r].join("")));else{const t=o[1];if(e)$(n,g([i,t,r].join("")));else{const e=b("u");e.textContent=t,s.f=a(t),$(n,g(i)),$(n,e),$(n,g(r))}}return s};let O=0,j=0;f(u,"mousedown",(t=>{O=t.clientX,j=t.clientY}));const B={"margin-right":"0.5em"},I={"flex-grow":"1",padding:`0 ${N("size-lg")}`};class X extends T{constructor(t,e){super(t);const n=this.t,s=b("span");if(!l(e.icon)){const t=b("span");A(t,"menu-item-icon"),x(t,B),$(s,t),$(t,e.icon)}A(s,"menu-item-label"),x(s,I),$(n,s);const i=L(e.label,!t.h);$(s,i.n),this.l=s,this.L((()=>t.F(this))),this.g=i.f}F(){A(this.e,"focus")}r(){const t=this.e;k(t,"focus")}get 0(){return!0}get _(){return!1}}const R=s=>{const i=t({label:"<NO_LABEL>",icon:null},F(s)),{label:o=i.label,icon:c=i.icon}=s;return r(o)||e("A menu item label MUST be a string."),l(c)||n(c,d)||e("A menu item icon MUST be a DocumentFragment."),i.label=o,i.icon=c,i},q={position:"absolute",height:"100%",width:N("size-lg"),"text-align":"center"},H={top:0,left:0},P={opacity:.4,cursor:"default"},W=[],Y=t=>{o(t)||e("A listener after click MUST be a function."),W.push(t)};class G extends X{constructor(t,e){super(t,e);const n=this.e,s=this.t,i=b("span"),o=b("span");A(i,"menu-item-accelerator"),A(o,"menu-item-checkbox"),x(i,I,{"text-align":"right"}),x(o,q,H),$(s,i),$(s,o),$(i,(t=>{const e=t.length-1,n=v();return t.forEach(((t,s)=>{$(n,t),s!==e&&$(n,g(" "))})),n})(e.accelerator)),f(n,"mouseup",(()=>this.C())),f(n,"contextmenu",_),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&(x(this.e,P),A(n,"disabled")),e.isChecked&&A(n,"checked")}get 0(){return!this.d}F(){this.d||super.F()}r(){this.d||super.r()}C(){this.c(),W.forEach((t=>t()))}A(){this.C()}}const J=()=>console.warn(void 0),K=[],Q=t=>(i(t)||e("Menu options MUST be an array."),t.map((t=>{i(t)||e("Menu item group options MUST be an array.");const n=t=>(t=>{t.type="type"in t?t.type:G;const n=K.find((e=>e.t===t.type));return void 0===n&&e("Invalid menu item type."),n.n(t)})(t);return t.reduce(((t,e)=>{const s=o(e)?e().map(n):[n(e)];return t.push(...s),t}),[])}))),V=(t,e)=>{K.push({t:t,n:e})},Z={display:"block","border-bottom":`1px solid ${N("mute-front-color")}`,margin:`${N("size-sm")} ${N("size-md")}`};class tt extends T{constructor(t){super(t),x(this.t,Z),this.L((()=>t.F()))}}const et=b("div"),nt={top:0,left:0,width:0,height:"100%",display:"block",position:"fixed","font-size":N("size-md")};x(et,nt),A(et,"menu-scope"),$(m,et);let st=null;const it=t=>{$(et,t.m),t.O()},ot=()=>{l(st)||(st.X(),st=null,ut=ht=null,x(et,{width:0}))},rt=()=>{ct().N()},ct=()=>{let t=st;for(;!l(t.e);)t=t.e.o;return t},lt=()=>{const t=ct();return!l(t.o)&&(t.o.C(),!0)},at={ArrowUp:()=>{ct().N(null,!0)},ArrowDown:rt,ArrowLeft:lt,ArrowRight:()=>{const t=ct(),e=t.f;e&&e.sm&&(t.E(),rt())},Escape:()=>lt()||ot(),Enter:()=>{const t=ct().f;t&&t.A()}};f(u,"mousedown",ot),f(u,"blur",ot);let ht=null,ut=null;const mt=Object.freeze({get expanding(){return ht},get expandable(){return ut},get closed(){return l(st)},next(){st&&st.N()}});f(u,"keydown",(t=>{const{key:e}=t;if(st){const n=ct();ht=!l(st.e),ut=!!n.f&&n.f._,e in at?at[e](t):U.test(e)&&n.N(a(e))&&n.f.A()}}));const dt={display:"block",position:"fixed",margin:0,padding:`${N("size-sm")} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":N("size-lg"),background:N("back-color"),color:N("front-color"),"user-select":"none",opacity:0,transition:`opacity ${N("animation-duration")}`},ft=t=>t[0];class pt extends M{constructor(){super();const t=b("ul");x(t,dt),A(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;f(t,"mouseleave",(()=>this.F())),f(t,"mousedown",w),f(t,"mouseenter",(()=>{let t=this.o;for(;!l(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get e(){return this.l.filter((t=>n(t,xt))).find((t=>!l(t.o)))||null}F(t=null){this.f&&this.f.r(),!l(t)&&t.F(),this[this.e===t?"xC":"C"](),this.f=t}E(){n(this.f,xt)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&n(e,xt)&&(this.d=setTimeout((()=>e.C()),t))}xC(){clearTimeout(this.d)}O(){requestAnimationFrame((()=>x(this.m,{opacity:1})))}X(){y(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}N(t=null,e=!1){const n=this.l.filter(ft);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(l(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const n=Q(t),s=new this,i=v();return s.h=e,n.forEach(((e,n)=>{if(e.forEach((t=>{const e=new t.type(s,t);s.A(e),$(i,e.e)})),n!==t.length-1){const t=new tt(s);s.A(t),$(i,t.e)}})),$(s.m,i),s}}const bt={right:0,top:0},gt=(t,e,n=0,s=0)=>{const i=e.bottom,o=e.top-s,r=e.right+n,c=e.left;x(t,{top:`${o}px`,left:`${r}px`});const l=C(t);l.bottom>u.innerHeight&&x(t,{top:i-t.offsetHeight+"px"}),l.right>u.innerWidth&&x(t,{left:c-t.offsetWidth+"px"})};class xt extends X{constructor(t,e){super(t,e);const n=b("span");x(n,q,bt),A(n,"menu-item-expanding"),$(this.t,n),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(l(this.o)){const t=pt.S(this.sm,this.$.h),e=C(this.e);t.o=this,this.o=t,it(t),gt(t.m,e,1,7)}}C(){const t=this.o;l(t)||(t.X(),this.o=null)}A(){this.E(),this.o.N()}_(){return!0}}var $t=Object.freeze({__proto__:null,Clickable:G,Spearator:tt,Submenu:xt});Y(ot),V(G,(s=>{const r=t({click:J,isChecked:!1,isDisabled:!1,accelerator:[]},R(s)),{click:l=r.click,isChecked:a=r.isChecked,isDisabled:h=r.isDisabled,accelerator:u=r.accelerator}=s;return o(l)||e("A `.click()` of clickable item MUST be a function."),c(a)||e("A `.isChecked` MUST be a `boolean`."),c(h)||e("A `.isDisabled` MUST be a `boolean`."),i(u)||e("A `.accelerator` MUST be an array of string."),r.accelerator=u.map((t=>(n(t,d)||e("A `.accelerator` MUST be a `DocumentFragement`."),t))),r.click=l,r.isChecked=a,r.isDisabled=h,r})),V(xt,(e=>{const n=t({submenu:[]},R(e)),{submenu:s=n.submenu}=e;return n.submenu=Q(s),n})),V(tt,(t=>F(t)));const yt=(t={})=>{const n={position:{x:O,y:j},mnemonic:!1,blocking:!1},{position:i=n.position,mnemonic:o=n.mnemonic,blocking:r=n.blocking}=t;if(c(o)||e("A `modifier.mnemonic` MUST be a boolean."),c(r)||e("A `modifier.blocking` MUST be a boolean."),s(i,"object")){const{x:t=n.position.x,y:s=n.position.y}=i;(isNaN(t)||isNaN(s))&&e("Invalid position."),n.position.x=t,n.position.y=s}else e("A `modifier.position` MUST be a boolean.");return n.mnemonic=o,n.blocking=r,n},At=(t,e)=>{const{position:n,mnemonic:s,blocking:i}=yt(e),o=pt.S(t,s);((t,e=!1)=>{ot(),st=t,e&&x(et,{width:"100%"})})(o,i),it(o),gt(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(n))},kt={_:null,$:null,x:!1},wt=()=>!l(kt._)&&!l(kt.$);let _t=!1,Ct=!1;f(u,"keyup",(t=>{"Alt"===t.key&&(_t=!1)}));const vt={Alt:()=>{if(!_t){_t=!0;const t=kt.$.b;t.length>0&&(l(kt.$.f)?(ot(),kt.x=kt.$.h=!0,kt.$.f=t[0]):Et())}},Enter:()=>{Ct?Ct=!1:kt.$.a||(kt.$.a=!0,mt.next())},ArrowDown:()=>{kt.$.a||(kt.$.a=!0,mt.next())},ArrowLeft:()=>{kt.x&&(mt.closed||!1===mt.expanding)&&(kt.$.N(null,!0),kt.$.a&&mt.next())},ArrowRight:()=>{kt.x&&(mt.closed||!1===mt.expandable)&&(kt.$.N(),kt.$.a&&mt.next())},Escape:()=>{mt.closed&&(kt.$.a?kt.$.a=!1:kt.$.f&&Et())}},Et=()=>{wt()&&(kt.$.f=null,_t=kt.$.a=kt.$.h=kt.x=!1)};Y((()=>{Ct=!0,Et()})),f(u,"mousedown",Et),f(u,"mouseup",Et),f(u,"blur",Et),f(u,"keydown",(t=>{if(wt()){const e=t.key;e in vt?vt[e]():U.test(e)&&mt.closed&&(kt.$.a||(kt.$.a=!0),kt.$.N(a(e))&&mt.next())}}));const St=()=>{kt.$&&kt._&&(p(kt._),$(kt._,kt.$.e))},Mt={display:"flex",flex:1,"user-select":"none",height:`${N("bar-height")}`,"line-height":`${N("bar-height")}`,"font-size":N("size-md"),color:N("front-color")};class Tt{constructor(){const t=b("div");A(t,"menu-bar"),x(t,Mt),this.e=t,this.b=[],f(t,"click",(()=>this.a=!this.a)),f(t,"mousedown",w),f(t,"mouseup",w),f(t,"contextmenu",_),f(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get h(){return this._h}set h(t){this._h=t,this.b.forEach((t=>t.S())),(t?A:k)(this.e,"has-mnemonic")}get a(){return this._a}set a(t){if(t!==this._a){const e=this.e;t?(A(e,"active"),kt.x=!0,this._f&&this._f.O()):(k(e,"active"),ot()),this._a=t}}get f(){return this._f}set f(t){const e=this.f;t!==e&&(l(e)||e.B(),l(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}N(t=null,e=!1){const n=this.b.slice(0);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(l(t)||o.m===t)return this.f=o,!0}return!1}}const Ft={padding:`0 ${N("size-sm")}`};class Nt{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const n=this.o=b("div"),s=this.i=b("div");A(n,"menu-bar-button"),A(s,"menu-bar-button-title"),$(n,s),x(n,Ft);f(n,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=L(this.t,!this.$.h);p(this.i),$(this.i,t.n),this.m=t.f}F(){A(this.o,"focus")}B(){k(this.o,"focus")}O(){const{left:t,bottom:e}=C(this.o),n=Q(this._());At(n,{position:{x:t,y:e},mnemonic:this.$.h})}}var zt=Object.freeze({__proto__:null,mount:t=>{kt._=t,St()},setMenuBar:t=>{const n=(i(s=t)||e("A menu bar options MUST be an array."),s.map((t=>{const n={title:"defalut",menu:[]},{title:s=n.title,menu:i=n.menu}=t;return r(s)||e("A menu bar button title MUST be a string."),n.menu=o(i)?i:()=>i,n.title=s,n})));var s;const c=kt.$=new Tt,l=v();n.forEach((t=>{const e=new Nt(c,t);c.A(e),$(l,e.o)})),$(c.e,l),St()}});export{zt as Bar,$t as MenuItem,ot as closeAllMenu,At as popup};
