/*!
 * @produck/menu v0.1.2
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).menu={})}(this,(function(t){"use strict";const e=Object.assign,n=t=>{throw new Error(t)},s=(t,e)=>t instanceof e,i=(t,e)=>typeof t===e,o=t=>Array.isArray(t),r=t=>i(t,"function"),c=t=>i(t,"string"),l=t=>i(t,"boolean"),a=t=>null===t,h=[],u=t=>(o(t)||n("Menu options MUST be an array."),t.map((t=>{o(t)||n("Menu item group options MUST be an array.");const e=t=>(t=>{const e=h.find((e=>e.t===t.type));return void 0===e&&n("Invalid menu item type."),e.n(t)})(t);return t.reduce(((t,n)=>{const s=r(n)?n().map(e):[e(n)];return t.push(...s),t}),[])}))),m=(t,e)=>{h.push({t:t,n:e})},d=document,f=window,p=d.body,b=DocumentFragment,g=(t,e,n)=>{t.addEventListener(e,n)},x=t=>Array.from(t.childNodes).map((e=>A(t,e))),$=t=>d.createElement(t),y=t=>d.createTextNode(t),w=(t,...e)=>{for(const n of e)for(const e in n)t.style.setProperty(e,n[e])},k=(t,e)=>{t.appendChild(e)},A=(t,e)=>{t.removeChild(e)},_=(t,...e)=>{t.classList.add(...e)},C=(t,...e)=>{t.classList.remove(...e)},v=t=>t.stopPropagation(),E=t=>{(t=>{t.preventDefault()})(t),v(t)},S=t=>t.getBoundingClientRect(),M=()=>d.createDocumentFragment(),T="L",N="A",F="front-color",U="size-sm",L="size-md",D="size-lg",O="bar-height",z=(j="menu",t=>`var(--${j}-${t})`);var j;const B=/^[a-z0-9`~?]$/i,I=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,X="f",P=(t,e=!1)=>{const n=M(),s={n:n,[X]:null},[,i,o,r]=t.match(I);if(void 0===o)k(n,y(i));else if("&&"===o)k(n,y([i,"&",r].join("")));else{const t=o[1];if(e)k(n,y([i,t,r].join("")));else{const e=$("u");e.textContent=t,s.f=t.toLowerCase(),k(n,y(i)),k(n,e),k(n,y(r))}}return s};let R=0,q=0;g(f,"mousedown",(t=>{R=t.clientX,q=t.clientY}));const H={display:"block",border:"1px solid transparent"},W={position:"relative",display:"flex"};class Y{}class G{constructor(t){s(t,Y)||(t=>{throw new Error(t)})("A menu required.");const e=$("li"),n=$("a");k(e,n),w(e,H),w(n,W),_(e,"menu-item"),this.e=e,this.t=n,this.$=t}[T](t){g(this.e,"mouseenter",t)}[N](){}get 0(){return!1}}const J=t=>{const e={id:null},{id:n=e.id,type:s}=t;return e.id=n,e.type=s,e},K="F",Q="r",V="e",Z="xC",tt="N",et="F",nt={"margin-right":"0.5em"},st={"flex-grow":"1",padding:`0 ${z(D)}`};class it extends G{constructor(t,e){super(t);const n=this.t,s=$("span");if(!a(e.icon)){const t=$("span");_(t,"menu-item-icon"),w(t,nt),k(s,t),k(t,e.icon)}_(s,"menu-item-label"),w(s,st),k(n,s);const i=P(e.label,!t.h);k(s,i.n),this.l=s,this.L((()=>t.F(this))),this.g=i.f}[K](){_(this.e,"focus")}[Q](){const t=this.e;C(t,"focus")}get 0(){return!0}get _(){return!1}}const ot=t=>{const i=e({label:"<NO_LABEL>",icon:null},J(t)),{label:o=i.label,icon:r=i.icon}=t;return c(o)||n("A menu item label MUST be a string."),a(r)||s(r,b)||n("A menu item icon MUST be a DocumentFragment."),i.label=o,i.icon=r,i},rt={position:"absolute",height:"100%",width:z(D),"text-align":"center"},ct="C",lt=$("div"),at={top:0,left:0,width:0,height:"100%",display:"block",position:"fixed","font-size":z(L)};w(lt,at),_(lt,"menu-scope"),k(p,lt);let ht=null;const ut=t=>{k(lt,t.m),t.O()},mt=()=>{a(ht)||(ht.X(),ht=null,xt=gt=null,w(lt,{width:0}))},dt=()=>{ft().N()},ft=()=>{let t=ht;for(;!a(t.e);)t=t.e.o;return t},pt=()=>{const t=ft();return!a(t.o)&&(t.o.C(),!0)},bt={ArrowUp:()=>{ft().N(null,!0)},ArrowDown:dt,ArrowLeft:pt,ArrowRight:()=>{const t=ft(),e=t.f;e&&e.sm&&(t.E(),dt())},Escape:()=>pt()||mt(),Enter:()=>{const t=ft().f;t&&t.A()}};g(f,"mousedown",mt),g(f,"blur",mt);let gt=null,xt=null;const $t=Object.freeze({get expanding(){return gt},get expandable(){return xt},get closed(){return a(ht)},next(){ht&&ht.N()}});g(f,"keydown",(t=>{const{key:e}=t;if(ht){const n=ft();gt=!a(ht.e),xt=n.f._,e in bt?bt[e](t):B.test(e)&&n.N(e.toLowerCase())&&n.f.A()}}));const yt={top:0,left:0},wt={opacity:.4,cursor:"default"};class kt extends it{constructor(t,e){super(t,e);const n=this.e,s=this.t,i=$("span"),o=$("span");_(i,"menu-item-accelerator"),_(o,"menu-item-checkbox"),w(i,st,{"text-align":"right"}),w(o,rt,yt),k(s,i),k(s,o),k(i,(t=>{const e=t.length-1,n=M();return t.forEach(((t,s)=>{k(n,t),s!==e&&k(n,y(" "))})),n})(e.accelerator)),g(n,"mouseup",(()=>this.C())),g(n,"contextmenu",E),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&(w(this.e,wt),_(n,"disabled")),e.isChecked&&_(n,"checked")}get 0(){return!this.d}[K](){this.d||super.F()}[Q](){this.d||super.r()}[ct](){this.c(),mt()}[N](){this.C()}}const At=()=>console.warn(void 0),_t={display:"block","border-bottom":`1px solid ${z("mute-front-color")}`,margin:`${z(U)} ${z(L)}`};class Ct extends G{constructor(t){super(t),w(this.t,_t),this.L((()=>t.F()))}}const vt={display:"block",position:"fixed",margin:0,padding:`${z(U)} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":z(D),background:z("back-color"),color:z(F),"user-select":"none",opacity:0,transition:`opacity ${z("animation-duration")}`},Et=t=>t[0];class St extends Y{constructor(){super();const t=$("ul");w(t,vt),_(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;g(t,"mouseleave",(()=>this.F())),g(t,"mousedown",v),g(t,"mouseenter",(()=>{let t=this.o;for(;!a(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get[V](){return this.l.filter((t=>s(t,Nt))).find((t=>!a(t.o)))||null}[et](t=null){this.f&&this.f.r(),!a(t)&&t.F(),this[this.e===t?Z:"C"](),this.f=t}E(){s(this.f,Nt)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&s(e,Nt)&&(this.d=setTimeout((()=>e.C()),t))}[Z](){clearTimeout(this.d)}O(){requestAnimationFrame((()=>w(this.m,{opacity:1})))}X(){A(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}[tt](t=null,e=!1){const n=this.l.filter(Et);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(a(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const n=u(t),s=new this,i=M();return s.h=e,n.forEach(((e,n)=>{e.forEach((t=>{const e=new t.type(s,t);s.A(e),k(i,e.e)})),n!==t.length-1&&s.A(new Ct(s))})),k(s.m,i),s}}const Mt={right:0,top:0},Tt=(t,e,n=0,s=0)=>{const i=e.bottom,o=e.top-s,r=e.right+n,c=e.left;w(t,{top:`${o}px`,left:`${r}px`});const l=S(t);l.bottom>f.innerHeight&&w(t,{top:i-t.offsetHeight+"px"}),l.right>f.innerWidth&&w(t,{left:c-t.offsetWidth+"px"})};class Nt extends it{constructor(t,e){super(t,e);const n=$("span");w(n,rt,Mt),_(n,"menu-item-expanding"),k(this.t,n),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(a(this.o)){const t=St.S(this.sm,this.$.h),e=S(this.e);t.o=this,this.o=t,ut(t),Tt(t.m,e,1,7)}}C(){const t=this.o;a(t)||(t.X(),this.o=null)}[N](){this.E(),this.o.N()}_(){return!0}}var Ft=Object.freeze({__proto__:null,Clickable:kt,Spearator:Ct,Submenu:Nt});m(kt,(t=>{const i=e({click:At,isChecked:!1,isDisabled:!1,accelerator:[]},ot(t)),{click:c=i.click,isChecked:a=i.isChecked,isDisabled:h=i.isDisabled,accelerator:u=i.accelerator}=t;return r(c)||n("A `.click()` of clickable item MUST be a function."),l(a)||n("A `.isChecked` MUST be a `boolean`."),l(h)||n("A `.isDisabled` MUST be a `boolean`."),o(u)||n("A `.accelerator` MUST be an array of string."),i.accelerator=u.map((t=>(s(t,b)||n("A `.accelerator` MUST be a `DocumentFragement`."),t))),i.click=c,i.isChecked=a,i.isDisabled=h,i})),m(Nt,(t=>{const n=e({submenu:[]},ot(t)),{submenu:s=n.submenu}=t;return n.submenu=u(s),n})),m(Ct,(t=>J(t)));const Ut=(t={})=>{const e={position:{x:R,y:q},mnemonic:!1,blocking:!1},{position:s=e.position,mnemonic:o=e.mnemonic,blocking:r=e.blocking}=t;if(l(o)||n("A `modifier.mnemonic` MUST be a boolean."),l(r)||n("A `modifier.blocking` MUST be a boolean."),i(s,"object")){const{x:t=e.position.x,y:i=e.position.y}=s;(isNaN(t)||isNaN(i))&&n("Invalid position."),e.position.x=t,e.position.y=i}else n("A `modifier.position` MUST be a boolean.");return e.mnemonic=o,e.blocking=r,e},Lt=(t,e)=>{const{position:n,mnemonic:s,blocking:i}=Ut(e),o=St.S(t,s);((t,e=!1)=>{mt(),ht=t,e&&w(lt,{width:"100%"})})(o,i),ut(o),Tt(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(n))},Dt="a",Ot="h",zt="f",jt="N",Bt="_",It="$",Xt="x",Pt={[Bt]:null,[It]:null,[Xt]:!1},Rt=()=>!a(Pt._)&&!a(Pt.$);let qt=!1;g(f,"keyup",(t=>{"Alt"===t.key&&(qt=!1)}));const Ht={Alt:()=>{if(!qt){qt=!0;const t=Pt.$.b;t.length>0&&(a(Pt.$.f)?(mt(),Pt.x=Pt.$.h=!0,Pt.$.f=t[0]):Wt())}},Enter:()=>{Pt.$.a||(Pt.$.a=!0,$t.next())},ArrowDown:()=>{Pt.$.a||(Pt.$.a=!0,$t.next())},ArrowLeft:()=>{Pt.x&&($t.closed||!1===$t.expanding)&&(Pt.$.N(null,!0),Pt.$.a&&$t.next())},ArrowRight:()=>{Pt.x&&($t.closed||!1===$t.expandable)&&(Pt.$.N(),Pt.$.a&&$t.next())},Escape:()=>{$t.closed&&(Pt.$.a?Pt.$.a=!1:Pt.$.f&&Wt())}},Wt=()=>{Rt()&&(Pt.$.f=null,qt=Pt.$.a=Pt.$.h=Pt.x=!1)};g(f,"mousedown",Wt),g(f,"mouseup",Wt),g(f,"blur",Wt),g(f,"keydown",(t=>{if(Rt()){const e=t.key;e in Ht?Ht[e]():B.test(e)&&$t.closed&&(Pt.$.a||(Pt.$.a=!0),Pt.$.N(e.toLowerCase())&&$t.next())}}));const Yt=()=>{Pt.$&&Pt._&&(x(Pt._),k(Pt._,Pt.$.e))},Gt={display:"flex",flex:1,"user-select":"none",height:`${z(O)}`,"line-height":`${z(O)}`,"font-size":z(L),color:z(F)};class Jt{constructor(){const t=$("div");_(t,"menu-bar"),w(t,Gt),this.e=t,this.b=[],g(t,"click",(()=>this.a=!this.a)),g(t,"mousedown",v),g(t,"mouseup",v),g(t,"contextmenu",E),g(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get[Ot](){return this._h}set[Ot](t){this._h=t,this.b.forEach((t=>t.S())),(t?_:C)(this.e,"has-mnemonic")}get[Dt](){return this._a}set[Dt](t){if(t!==this._a){const e=this.e;t?(_(e,"active"),Pt.x=!0,this._f&&this._f.O()):(C(e,"active"),mt()),this._a=t}}get[zt](){return this._f}set[zt](t){const e=this.f;t!==e&&(a(e)||e.B(),a(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}[jt](t=null,e=!1){const n=this.b.slice(0);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(a(t)||o.m===t)return this.f=o,!0}return!1}}const Kt={padding:`0 ${z(U)}`};class Qt{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const n=this.o=$("div"),s=this.i=$("div");_(n,"menu-bar-button"),_(s,"menu-bar-button-title"),k(n,s),w(n,Kt);g(n,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=P(this.t,!this.$.h);x(this.i),k(this.i,t.n),this.m=t.f}F(){_(this.o,"focus")}B(){C(this.o,"focus")}O(){const{left:t,bottom:e}=S(this.o),n=u(this._());Lt(n,{position:{x:t,y:e},mnemonic:this.$.h})}}var Vt=Object.freeze({__proto__:null,mount:t=>{Pt._=t,Yt()},setMenuBar:t=>{const e=(o(s=t)||n("A menu bar options MUST be an array."),s.map((t=>{const e={title:"defalut",menu:[]},{title:s=e.title,menu:i=e.menu}=t;return c(s)||n("A menu bar button title MUST be a string."),e.menu=r(i)?i:()=>i,e.title=s,e})));var s;const i=Pt.$=new Jt,l=M();e.forEach((t=>{const e=new Qt(i,t);i.A(e),k(l,e.o)})),k(i.e,l),Yt()}});t.Bar=Vt,t.MenuItem=Ft,t.closeAllMenu=mt,t.popup=Lt,Object.defineProperty(t,"__esModule",{value:!0})}));
