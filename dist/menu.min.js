/*!
 * @produck/menu v0.1.0
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).menu={})}(this,(function(t){"use strict";const e=Object.assign,n=t=>{throw new Error(t)},s=(t,e)=>t instanceof e,i=(t,e)=>typeof t===e,o=t=>Array.isArray(t),r=t=>i(t,"function"),c=t=>i(t,"string"),l=t=>i(t,"boolean"),a=t=>null===t,h=[],u=t=>(o(t)||n("Menu options MUST be an array."),t.map((t=>{o(t)||n("Menu item group options MUST be an array.");const e=t=>(t=>{const e=h.find((e=>e.t===t.type));return void 0===e&&n("Invalid menu item type."),e.n(t)})(t);return t.reduce(((t,n)=>{const s=r(n)?n().map(e):[e(n)];return t.push(...s),t}),[])}))),m=(t,e)=>{h.push({t:t,n:e})},d=document,f=window,p=d.body,b=requestAnimationFrame,g=DocumentFragment,x=(t,e,n)=>{t.addEventListener(e,n)},$=t=>Array.from(t.childNodes).map((e=>_(t,e))),y=t=>d.createElement(t),w=t=>d.createTextNode(t),k=(t,...e)=>{for(const n of e)for(const e in n)t.style.setProperty(e,n[e])},A=(t,e)=>{t.appendChild(e)},_=(t,e)=>{t.removeChild(e)},C=(t,...e)=>{t.classList.add(...e)},v=(t,...e)=>{t.classList.remove(...e)},E=t=>t.stopPropagation(),S=t=>{(t=>{t.preventDefault()})(t),E(t)},M=t=>t.getBoundingClientRect(),T=()=>d.createDocumentFragment(),F="L",N="A",U="front-color",L="size-sm",D="size-md",O="size-lg",z="bar-height",j=(B="menu",t=>`var(--${B}-${t})`);var B;const I=/^[a-z0-9`~?]$/i,X=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,P="f",R=(t,e=!1)=>{const n=T(),s={n:n,[P]:null},[,i,o,r]=t.match(X);if(void 0===o)A(n,w(i));else if("&&"===o)A(n,w([i,"&",r].join("")));else{const t=o[1];if(e)A(n,w([i,t,r].join("")));else{const e=y("u");e.textContent=t,s.f=t.toLowerCase(),A(n,w(i)),A(n,e),A(n,w(r))}}return s};let q=0,H=0;x(f,"mousedown",(t=>{q=t.clientX,H=t.clientY}));const W={display:"block",border:"1px solid transparent"},Y={position:"relative",display:"flex"};class G{}class J{constructor(t){s(t,G)||(t=>{throw new Error(t)})("A menu required.");const e=y("li"),n=y("a");A(e,n),k(e,W),k(n,Y),C(e,"menu-item"),this.e=e,this.t=n,this.$=t}[F](t){x(this.e,"mouseenter",t)}[N](){}get 0(){return!1}}const K=t=>{const e={id:null},{id:n=e.id,type:s}=t;return e.id=n,e.type=s,e},Q="F",V="r",Z="e",tt="xC",et="N",nt="F",st={"margin-right":"0.5em"},it={"flex-grow":"1",padding:`0 ${j(O)}`};class ot extends J{constructor(t,e){super(t);const n=this.t,s=y("span");if(!a(e.icon)){const t=y("span");C(t,"menu-item-icon"),k(t,st),A(s,t),A(t,e.icon)}C(s,"menu-item-label"),k(s,it),A(n,s);const i=R(e.label,!t.h);A(s,i.n),this.l=s,this.L((()=>t.F(this))),this.g=i.f}[Q](){C(this.e,"focus")}[V](){const t=this.e;v(t,"focus")}get 0(){return!0}get _(){return!1}}const rt=t=>{const i=e({label:"<NO_LABEL>",icon:null},K(t)),{label:o=i.label,icon:r=i.icon}=t;return c(o)||n("A menu item label MUST be a string."),a(r)||s(r,g)||n("A menu item icon MUST be a DocumentFragment."),i.label=o,i.icon=r,i},ct={position:"absolute",height:"100%",width:j(O),"text-align":"center"},lt="C",at=y("div"),ht={width:0,height:"100%",display:"block",position:"fixed","font-size":j(D)};k(at,ht),C(at,"menu-scope"),A(p,at);let ut=null;const mt=t=>{A(at,t.m),t.O()},dt=()=>{a(ut)||(ut.X(),ut=null,$t=xt=null,k(at,{width:0}))},ft=()=>{pt().N()},pt=()=>{let t=ut;for(;!a(t.e);)t=t.e.o;return t},bt=()=>{const t=pt();return!a(t.o)&&(t.o.C(),!0)},gt={ArrowUp:()=>{pt().N(null,!0)},ArrowDown:ft,ArrowLeft:bt,ArrowRight:()=>{const t=pt(),e=t.f;e&&e.sm&&(t.E(),ft())},Escape:()=>bt()||dt(),Enter:()=>{const t=pt().f;t&&t.A()}};x(f,"mousedown",dt),x(f,"blur",dt);let xt=null,$t=null;const yt=Object.freeze({get expanding(){return xt},get expandable(){return $t},get closed(){return a(ut)},next(){ut&&ut.N()}});x(f,"keydown",(t=>{const{key:e}=t;if(ut){const n=pt();xt=!a(ut.e),$t=n.f._,e in gt?gt[e](t):I.test(e)&&n.N(e.toLowerCase())&&n.f.A()}}));const wt={top:0,left:0},kt={opacity:.4,cursor:"default"};class At extends ot{constructor(t,e){super(t,e);const n=this.e,s=this.t,i=y("span"),o=y("span");C(i,"menu-item-accelerator"),C(o,"menu-item-checkbox"),k(i,it,{"text-align":"right"}),k(o,ct,wt),A(s,i),A(s,o),A(i,(t=>{const e=t.length-1,n=T();return t.forEach(((t,s)=>{A(n,t),s!==e&&A(n,w(" "))})),n})(e.accelerator)),x(n,"mouseup",(()=>this.C())),x(n,"contextmenu",S),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&(k(this.e,kt),C(n,"disabled")),e.isChecked&&C(n,"checked")}get 0(){return!this.d}[Q](){this.d||super.F()}[V](){this.d||super.r()}[lt](){this.c(),dt()}[N](){this.C()}}const _t=()=>console.warn(void 0),Ct={display:"block","border-bottom":`1px solid ${j("mute-front-color")}`,margin:`${j(L)} ${j(D)}`};class vt extends J{constructor(t){super(t),k(this.t,Ct),this.L((()=>t.F()))}}const Et={display:"block",position:"fixed",margin:0,padding:`${j(L)} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":j(O),background:j("back-color"),color:j(U),"user-select":"none",opacity:0,transition:`opacity ${j("animation-duration")}`},St=t=>t[0];class Mt extends G{constructor(){super();const t=y("ul");k(t,Et),C(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;x(t,"mouseleave",(()=>this.F())),x(t,"mousedown",E),x(t,"mouseenter",(()=>{let t=this.o;for(;!a(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get[Z](){return this.l.filter((t=>s(t,Nt))).find((t=>!a(t.o)))||null}[nt](t=null){this.f&&this.f.r(),!a(t)&&t.F(),this[this.e===t?tt:"C"](),this.f=t}E(){s(this.f,Nt)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&s(e,Nt)&&(this.d=setTimeout((()=>e.C()),t))}[tt](){clearTimeout(this.d)}O(){b((()=>k(this.m,{opacity:1})))}X(){_(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}[et](t=null,e=!1){const n=this.l.filter(St);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(a(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const n=u(t),s=new this,i=T();return s.h=e,n.forEach(((e,n)=>{e.forEach((t=>{const e=new t.type(s,t);s.A(e),A(i,e.e)})),n!==t.length-1&&s.A(new vt(s))})),A(s.m,i),s}}const Tt={right:0,top:0},Ft=(t,e,n=0,s=0)=>{const i=e.bottom,o=e.top-s,r=e.right+n,c=e.left;k(t,{top:`${o}px`,left:`${r}px`});const l=M(t);l.bottom>f.innerHeight&&k(t,{top:i-t.offsetHeight+"px"}),l.right>f.innerWidth&&k(t,{left:c-t.offsetWidth+"px"})};class Nt extends ot{constructor(t,e){super(t,e);const n=y("span");k(n,ct,Tt),C(n,"menu-item-expanding"),A(this.t,n),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(a(this.o)){const t=Mt.S(this.sm,this.$.h),e=M(this.e);t.o=this,this.o=t,mt(t),Ft(t.m,e,1,7)}}C(){const t=this.o;a(t)||(t.X(),this.o=null)}[N](){this.E(),this.o.N()}_(){return!0}}var Ut=Object.freeze({__proto__:null,Base:J,Function:ot,Clickable:At,Spearator:vt,Submenu:Nt});m(At,(t=>{const i=e({click:_t,isChecked:!1,isDisabled:!1,accelerator:[]},rt(t)),{click:c=i.click,isChecked:a=i.isChecked,isDisabled:h=i.isDisabled,accelerator:u=i.accelerator}=t;return r(c)||n("A `.click()` of clickable item MUST be a function."),l(a)||n("A `.isChecked` MUST be a `boolean`."),l(h)||n("A `.isDisabled` MUST be a `boolean`."),o(u)||n("A `.accelerator` MUST be an array of string."),i.accelerator=u.map((t=>(s(t,g)||n("A `.accelerator` MUST be a `DocumentFragement`."),t))),i.click=c,i.isChecked=a,i.isDisabled=h,i})),m(Nt,(t=>{const n=e({submenu:[]},rt(t)),{submenu:s=n.submenu}=t;return n.submenu=u(s),n})),m(vt,(t=>K(t)));const Lt=t=>{const e={position:{x:q,y:H},mnemonic:!1,blocking:!1},{position:s=e.position,mnemonic:o=e.mnemonic,blocking:r=e.blocking}=t;if(l(o)||n("A `modifier.mnemonic` MUST be a boolean."),l(r)||n("A `modifier.blocking` MUST be a boolean."),i(s,"object")){const{x:t=e.position.x,y:i=e.position.y}=s;(isNaN(t)||isNaN(i))&&n("Invalid position."),e.position.x=t,e.position.y=i}else n("A `modifier.position` MUST be a boolean.");return e.mnemonic=o,e.blocking=r,e},Dt=(t,e)=>{const{position:n,mnemonic:s,blocking:i}=Lt(e),o=Mt.S(t,s);((t,e=!1)=>{dt(),ut=t,e&&k(at,{width:"100%"})})(o,i),mt(o),Ft(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(n))},Ot="a",zt="h",jt="f",Bt="N",It="_",Xt="$",Pt="x",Rt={[It]:null,[Xt]:null,[Pt]:!1},qt=()=>!a(Rt._)&&!a(Rt.$);let Ht=!1;x(f,"keyup",(t=>{"Alt"===t.key&&(Ht=!1)}));const Wt={Alt:()=>{if(!Ht){Ht=!0;const t=Rt.$.b;t.length>0&&(a(Rt.$.f)?(dt(),Rt.x=Rt.$.h=!0,Rt.$.f=t[0]):Yt())}},Enter:()=>{Rt.$.a||(Rt.$.a=!0,yt.next())},ArrowDown:()=>{Rt.$.a||(Rt.$.a=!0,yt.next())},ArrowLeft:()=>{Rt.x&&(yt.closed||!1===yt.expanding)&&(Rt.$.N(null,!0),Rt.$.a&&yt.next())},ArrowRight:()=>{Rt.x&&(yt.closed||!1===yt.expandable)&&(Rt.$.N(),Rt.$.a&&yt.next())},Escape:()=>{yt.closed&&(Rt.$.a?Rt.$.a=!1:Rt.$.f&&Yt())}},Yt=()=>{qt()&&(Rt.$.f=null,Ht=Rt.$.a=Rt.$.h=Rt.x=!1)};x(f,"mousedown",Yt),x(f,"mouseup",Yt),x(f,"blur",Yt),x(f,"keydown",(t=>{if(qt()){const e=t.key;e in Wt?Wt[e]():I.test(e)&&yt.closed&&(Rt.$.a||(Rt.$.a=!0),Rt.$.N(e.toLowerCase())&&yt.next())}}));const Gt=()=>{Rt.$&&Rt._&&($(Rt._),A(Rt._,Rt.$.e))},Jt={display:"flex",flex:1,"user-select":"none",height:`${j(z)}`,"line-height":`${j(z)}`,"font-size":j(D),color:j(U)};class Kt{constructor(){const t=y("div");C(t,"menu-bar"),k(t,Jt),this.e=t,this.b=[],x(t,"click",(()=>this.a=!this.a)),x(t,"mousedown",E),x(t,"mouseup",E),x(t,"contextmenu",S),x(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get[zt](){return this._h}set[zt](t){this._h=t,this.b.forEach((t=>t.S())),(t?C:v)(this.e,"has-mnemonic")}get[Ot](){return this._a}set[Ot](t){if(t!==this._a){const e=this.e;t?(C(e,"active"),Rt.x=!0,this._f&&this._f.O()):(v(e,"active"),dt()),this._a=t}}get[jt](){return this._f}set[jt](t){const e=this.f;t!==e&&(a(e)||e.B(),a(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}[Bt](t=null,e=!1){const n=this.b.slice(0);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(a(t)||o.m===t)return this.f=o,!0}return!1}}const Qt={padding:`0 ${j(L)}`};class Vt{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const n=this.o=y("div"),s=this.i=y("div");C(n,"menu-bar-button"),C(s,"menu-bar-button-title"),A(n,s),k(n,Qt);x(n,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=R(this.t,!this.$.h);$(this.i),A(this.i,t.n),this.m=t.f}F(){C(this.o,"focus")}B(){v(this.o,"focus")}O(){const{left:t,bottom:e}=M(this.o);Dt(this._,{position:{x:t,y:e},mnemonic:this.$.h})}}var Zt=Object.freeze({__proto__:null,mount:t=>{Rt._=t,Gt()},setMenuBar:t=>{const e=(o(s=t)||n("A menu bar options MUST be an array."),s.map((t=>{const e={title:"defalut",menu:[]},{title:s=e.title,menu:i=e.menu}=t;return c(s)||n("A menu bar button title MUST be a string."),e.menu=u(i),e.title=s,e})));var s;const i=Rt.$=new Kt,r=T();e.forEach((t=>{const e=new Vt(i,t);i.A(e),A(r,e.o)})),A(i.e,r),Gt()}});t.Bar=Zt,t.MenuItem=Ut,t.closeAllMenu=dt,t.popup=Dt,Object.defineProperty(t,"__esModule",{value:!0})}));
