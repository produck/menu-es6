/*!
 * @produck/menu v0.1.5
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).menu={})}(this,(function(t){"use strict";const e=Object.assign,n=t=>{throw new Error(t)},s=(t,e)=>t instanceof e,i=(t,e)=>typeof t===e,o=t=>Array.isArray(t),r=t=>i(t,"function"),c=t=>i(t,"string"),l=t=>i(t,"boolean"),a=t=>null===t,h=t=>t.toLowerCase(),u=document,m=window,d=u.body,f=DocumentFragment,p=(t,e,n)=>{t.addEventListener(e,n)},b=t=>Array.from(t.childNodes).map((e=>k(t,e))),g=t=>u.createElement(t),x=t=>u.createTextNode(t),$=(t,...e)=>{for(const n of e)for(const e in n)t.style.setProperty(e,n[e])},y=(t,e)=>{t.appendChild(e)},k=(t,e)=>{t.removeChild(e)},A=(t,...e)=>{t.classList.add(...e)},w=(t,...e)=>{t.classList.remove(...e)},_=t=>t.stopPropagation(),v=t=>{(t=>{t.preventDefault()})(t),_(t)},C=t=>t.getBoundingClientRect(),E=()=>u.createDocumentFragment(),S="L",M="A",T={display:"block",border:"1px solid transparent"},N={position:"relative",display:"flex"};class F{}class U{constructor(t){s(t,F)||n("A menu required.");const e=g("li"),i=g("a");y(e,i),$(e,T),$(i,N),A(e,"menu-item"),this.e=e,this.t=i,this.$=t}[S](t){p(this.e,"mouseenter",t)}[M](){}get 0(){return!1}}const D=t=>{const e={id:null},{id:n=e.id,type:s}=t;return e.id=n,e.type=s,e},L="front-color",O="size-sm",z="size-md",j="size-lg",B="bar-height",I=(X="menu",t=>`var(--${X}-${t})`);var X;const P=/^[a-z0-9`~?]$/i,R=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,q="f",H=(t,e=!1)=>{const n=E(),s={n:n,[q]:null},[,i,o,r]=t.match(R);if(void 0===o)y(n,x(i));else if("&&"===o)y(n,x([i,"&",r].join("")));else{const t=o[1];if(e)y(n,x([i,t,r].join("")));else{const e=g("u");e.textContent=t,s.f=h(t),y(n,x(i)),y(n,e),y(n,x(r))}}return s};let W=0,Y=0;p(m,"mousedown",(t=>{W=t.clientX,Y=t.clientY}));const G="F",J="r",K="e",Q="xC",V="N",Z="F",tt={"margin-right":"0.5em"},et={"flex-grow":"1",padding:`0 ${I(j)}`};class nt extends U{constructor(t,e){super(t);const n=this.t,s=g("span");if(!a(e.icon)){const t=g("span");A(t,"menu-item-icon"),$(t,tt),y(s,t),y(t,e.icon)}A(s,"menu-item-label"),$(s,et),y(n,s);const i=H(e.label,!t.h);y(s,i.n),this.l=s,this.L((()=>t.F(this))),this.g=i.f}[G](){A(this.e,"focus")}[J](){const t=this.e;w(t,"focus")}get 0(){return!0}get _(){return!1}}const st=t=>{const i=e({label:"<NO_LABEL>",icon:null},D(t)),{label:o=i.label,icon:r=i.icon}=t;return c(o)||n("A menu item label MUST be a string."),a(r)||s(r,f)||n("A menu item icon MUST be a DocumentFragment."),i.label=o,i.icon=r,i},it={position:"absolute",height:"100%",width:I(j),"text-align":"center"},ot="C",rt={top:0,left:0},ct={opacity:.4,cursor:"default"},lt=[],at=t=>{r(t)||n("A listener after click MUST be a function."),lt.push(t)};class ht extends nt{constructor(t,e){super(t,e);const n=this.e,s=this.t,i=g("span"),o=g("span");A(i,"menu-item-accelerator"),A(o,"menu-item-checkbox"),$(i,et,{"text-align":"right"}),$(o,it,rt),y(s,i),y(s,o),y(i,(t=>{const e=t.length-1,n=E();return t.forEach(((t,s)=>{y(n,t),s!==e&&y(n,x(" "))})),n})(e.accelerator)),p(n,"mouseup",(()=>this.C())),p(n,"contextmenu",v),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&($(this.e,ct),A(n,"disabled")),e.isChecked&&A(n,"checked")}get 0(){return!this.d}[G](){this.d||super.F()}[J](){this.d||super.r()}[ot](){this.c(),lt.forEach((t=>t()))}[M](){this.C()}}const ut=()=>console.warn(void 0),mt=[],dt=t=>(o(t)||n("Menu options MUST be an array."),t.map((t=>{o(t)||n("Menu item group options MUST be an array.");const e=t=>(t=>{t.type="type"in t?t.type:ht;const e=mt.find((e=>e.t===t.type));return void 0===e&&n("Invalid menu item type."),e.n(t)})(t);return t.reduce(((t,n)=>{const s=r(n)?n().map(e):[e(n)];return t.push(...s),t}),[])}))),ft=(t,e)=>{mt.push({t:t,n:e})},pt={display:"block","border-bottom":`1px solid ${I("mute-front-color")}`,margin:`${I(O)} ${I(z)}`};class bt extends U{constructor(t){super(t),$(this.t,pt),this.L((()=>t.F()))}}const gt=g("div"),xt={top:0,left:0,width:0,height:"100%",display:"block",position:"fixed","font-size":I(z)};$(gt,xt),A(gt,"menu-scope"),y(d,gt);let $t=null;const yt=t=>{y(gt,t.m),t.O()},kt=()=>{a($t)||($t.X(),$t=null,Et=Ct=null,$(gt,{width:0}))},At=()=>{wt().N()},wt=()=>{let t=$t;for(;!a(t.e);)t=t.e.o;return t},_t=()=>{const t=wt();return!a(t.o)&&(t.o.C(),!0)},vt={ArrowUp:()=>{wt().N(null,!0)},ArrowDown:At,ArrowLeft:_t,ArrowRight:()=>{const t=wt(),e=t.f;e&&e.sm&&(t.E(),At())},Escape:()=>_t()||kt(),Enter:()=>{const t=wt().f;t&&t.A()}};p(m,"mousedown",kt),p(m,"blur",kt);let Ct=null,Et=null;const St=Object.freeze({get expanding(){return Ct},get expandable(){return Et},get closed(){return a($t)},next(){$t&&$t.N()}});p(m,"keydown",(t=>{const{key:e}=t;if($t){const n=wt();Ct=!a($t.e),Et=!!n.f&&n.f._,e in vt?vt[e](t):P.test(e)&&n.N(h(e))&&n.f.A()}}));const Mt={display:"block",position:"fixed",margin:0,padding:`${I(O)} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":I(j),background:I("back-color"),color:I(L),"user-select":"none",opacity:0,transition:`opacity ${I("animation-duration")}`},Tt=t=>t[0];class Nt extends F{constructor(){super();const t=g("ul");$(t,Mt),A(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;p(t,"mouseleave",(()=>this.F())),p(t,"mousedown",_),p(t,"mouseenter",(()=>{let t=this.o;for(;!a(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get[K](){return this.l.filter((t=>s(t,Dt))).find((t=>!a(t.o)))||null}[Z](t=null){this.f&&this.f.r(),!a(t)&&t.F(),this[this.e===t?Q:"C"](),this.f=t}E(){s(this.f,Dt)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&s(e,Dt)&&(this.d=setTimeout((()=>e.C()),t))}[Q](){clearTimeout(this.d)}O(){requestAnimationFrame((()=>$(this.m,{opacity:1})))}X(){k(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}[V](t=null,e=!1){const n=this.l.filter(Tt);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(a(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const n=dt(t),s=new this,i=E();return s.h=e,n.forEach(((e,n)=>{if(e.forEach((t=>{const e=new t.type(s,t);s.A(e),y(i,e.e)})),n!==t.length-1){const t=new bt(s);s.A(t),y(i,t.e)}})),y(s.m,i),s}}const Ft={right:0,top:0},Ut=(t,e,n=0,s=0)=>{const i=e.bottom,o=e.top-s,r=e.right+n,c=e.left;$(t,{top:`${o}px`,left:`${r}px`});const l=C(t);l.bottom>m.innerHeight&&$(t,{top:i-t.offsetHeight+"px"}),l.right>m.innerWidth&&$(t,{left:c-t.offsetWidth+"px"})};class Dt extends nt{constructor(t,e){super(t,e);const n=g("span");$(n,it,Ft),A(n,"menu-item-expanding"),y(this.t,n),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(a(this.o)){const t=Nt.S(this.sm,this.$.h),e=C(this.e);t.o=this,this.o=t,yt(t),Ut(t.m,e,1,7)}}C(){const t=this.o;a(t)||(t.X(),this.o=null)}[M](){this.E(),this.o.N()}_(){return!0}}var Lt=Object.freeze({__proto__:null,Clickable:ht,Spearator:bt,Submenu:Dt});at(kt),ft(ht,(t=>{const i=e({click:ut,isChecked:!1,isDisabled:!1,accelerator:[]},st(t)),{click:c=i.click,isChecked:a=i.isChecked,isDisabled:h=i.isDisabled,accelerator:u=i.accelerator}=t;return r(c)||n("A `.click()` of clickable item MUST be a function."),l(a)||n("A `.isChecked` MUST be a `boolean`."),l(h)||n("A `.isDisabled` MUST be a `boolean`."),o(u)||n("A `.accelerator` MUST be an array of string."),i.accelerator=u.map((t=>(s(t,f)||n("A `.accelerator` MUST be a `DocumentFragement`."),t))),i.click=c,i.isChecked=a,i.isDisabled=h,i})),ft(Dt,(t=>{const n=e({submenu:[]},st(t)),{submenu:s=n.submenu}=t;return n.submenu=dt(s),n})),ft(bt,(t=>D(t)));const Ot=(t={})=>{const e={position:{x:W,y:Y},mnemonic:!1,blocking:!1},{position:s=e.position,mnemonic:o=e.mnemonic,blocking:r=e.blocking}=t;if(l(o)||n("A `modifier.mnemonic` MUST be a boolean."),l(r)||n("A `modifier.blocking` MUST be a boolean."),i(s,"object")){const{x:t=e.position.x,y:i=e.position.y}=s;(isNaN(t)||isNaN(i))&&n("Invalid position."),e.position.x=t,e.position.y=i}else n("A `modifier.position` MUST be a boolean.");return e.mnemonic=o,e.blocking=r,e},zt=(t,e)=>{const{position:n,mnemonic:s,blocking:i}=Ot(e),o=Nt.S(t,s);((t,e=!1)=>{kt(),$t=t,e&&$(gt,{width:"100%"})})(o,i),yt(o),Ut(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(n))},jt="a",Bt="h",It="f",Xt="N",Pt="_",Rt="$",qt="x",Ht={[Pt]:null,[Rt]:null,[qt]:!1},Wt=()=>!a(Ht._)&&!a(Ht.$);let Yt=!1,Gt=!1;p(m,"keyup",(t=>{"Alt"===t.key&&(Yt=!1)}));const Jt={Alt:()=>{if(!Yt){Yt=!0;const t=Ht.$.b;t.length>0&&(a(Ht.$.f)?(kt(),Ht.x=Ht.$.h=!0,Ht.$.f=t[0]):Kt())}},Enter:()=>{Gt?Gt=!1:Ht.$.a||(Ht.$.a=!0,St.next())},ArrowDown:()=>{Ht.$.a||(Ht.$.a=!0,St.next())},ArrowLeft:()=>{Ht.x&&(St.closed||!1===St.expanding)&&(Ht.$.N(null,!0),Ht.$.a&&St.next())},ArrowRight:()=>{Ht.x&&(St.closed||!1===St.expandable)&&(Ht.$.N(),Ht.$.a&&St.next())},Escape:()=>{St.closed&&(Ht.$.a?Ht.$.a=!1:Ht.$.f&&Kt())}},Kt=()=>{Wt()&&(Ht.$.f=null,Yt=Ht.$.a=Ht.$.h=Ht.x=!1)};at((()=>{Gt=!0,Kt()})),p(m,"mousedown",Kt),p(m,"mouseup",Kt),p(m,"blur",Kt),p(m,"keydown",(t=>{if(Wt()){const e=t.key;e in Jt?Jt[e]():P.test(e)&&St.closed&&(Ht.$.a||(Ht.$.a=!0),Ht.$.N(h(e))&&St.next())}}));const Qt=()=>{Ht.$&&Ht._&&(b(Ht._),y(Ht._,Ht.$.e))},Vt={display:"flex",flex:1,"user-select":"none",height:`${I(B)}`,"line-height":`${I(B)}`,"font-size":I(z),color:I(L)};class Zt{constructor(){const t=g("div");A(t,"menu-bar"),$(t,Vt),this.e=t,this.b=[],p(t,"click",(()=>this.a=!this.a)),p(t,"mousedown",_),p(t,"mouseup",_),p(t,"contextmenu",v),p(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get[Bt](){return this._h}set[Bt](t){this._h=t,this.b.forEach((t=>t.S())),(t?A:w)(this.e,"has-mnemonic")}get[jt](){return this._a}set[jt](t){if(t!==this._a){const e=this.e;t?(A(e,"active"),Ht.x=!0,this._f&&this._f.O()):(w(e,"active"),kt()),this._a=t}}get[It](){return this._f}set[It](t){const e=this.f;t!==e&&(a(e)||e.B(),a(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}[Xt](t=null,e=!1){const n=this.b.slice(0);e&&n.reverse();const s=n.findIndex((t=>t===this.f)),i=n.length;for(let e=0;e<i;e++){const o=n[(s+e+1)%i];if(a(t)||o.m===t)return this.f=o,!0}return!1}}const te={padding:`0 ${I(O)}`};class ee{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const n=this.o=g("div"),s=this.i=g("div");A(n,"menu-bar-button"),A(s,"menu-bar-button-title"),y(n,s),$(n,te);p(n,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=H(this.t,!this.$.h);b(this.i),y(this.i,t.n),this.m=t.f}F(){A(this.o,"focus")}B(){w(this.o,"focus")}O(){const{left:t,bottom:e}=C(this.o),n=dt(this._());zt(n,{position:{x:t,y:e},mnemonic:this.$.h})}}var ne=Object.freeze({__proto__:null,mount:t=>{Ht._=t,Qt()},setMenuBar:t=>{const e=(o(s=t)||n("A menu bar options MUST be an array."),s.map((t=>{const e={title:"defalut",menu:[]},{title:s=e.title,menu:i=e.menu}=t;return c(s)||n("A menu bar button title MUST be a string."),e.menu=r(i)?i:()=>i,e.title=s,e})));var s;const i=Ht.$=new Zt,l=E();e.forEach((t=>{const e=new ee(i,t);i.A(e),y(l,e.o)})),y(i.e,l),Qt()}});t.Bar=ne,t.MenuItem=Lt,t.closeAllMenu=kt,t.popup=zt,Object.defineProperty(t,"__esModule",{value:!0})}));
